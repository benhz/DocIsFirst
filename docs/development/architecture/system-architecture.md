# 系统架构

## 整体架构

```
┌─────────────────────────────────────────────────────────┐
│                      前端层                               │
│  Web 端  │  移动端  │  小程序  │  管理后台               │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│                    网关层 (Gateway)                      │
│   路由 │ 认证 │ 限流 │ 熔断 │ 日志 │ 监控                │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│                    业务服务层                             │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐             │
│  │ 用户服务  │  │ 订单服务  │  │ 商品服务  │             │
│  └──────────┘  └──────────┘  └──────────┘             │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐             │
│  │ 支付服务  │  │ 通知服务  │  │ 搜索服务  │             │
│  └──────────┘  └──────────┘  └──────────┘             │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│                    平台服务层                             │
│  账号 │ 权限 │ 消息 │ 文件 │ 日志 │ 配置                  │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│                    基础设施层                             │
│  MySQL │ Redis │ Kafka │ ES │ OSS │ K8s                 │
└─────────────────────────────────────────────────────────┘
```

## 分层说明

### 前端层
- **Web 端**：React + TypeScript，面向桌面用户
- **移动端**：React Native，iOS + Android
- **小程序**：微信小程序
- **管理后台**：Vue.js + Element UI

### 网关层
使用 Kong 作为 API 网关：
- 统一路由和负载均衡
- 认证鉴权（JWT）
- 限流熔断（保护后端服务）
- 日志收集和监控

### 业务服务层
采用微服务架构：
- **用户服务**：账号、登录、个人信息
- **订单服务**：订单创建、查询、状态流转
- **商品服务**：商品信息、分类、库存
- **支付服务**：支付、退款、对账
- **通知服务**：站内信、邮件、短信
- **搜索服务**：ElasticSearch 实现

详见 [服务划分](./services.md)

### 平台服务层
跨业务的通用能力，详见 [平台文档](../../platform/overview.md)

### 基础设施层
- **数据库**：MySQL（主）+ PostgreSQL（分析）
- **缓存**：Redis
- **消息队列**：Kafka
- **搜索引擎**：ElasticSearch
- **对象存储**：阿里云 OSS / AWS S3
- **容器编排**：Kubernetes

## 技术选型原则

1. **稳定性优先**：选择成熟、社区活跃的技术
2. **适配业务**：根据业务特点选型，不盲目追新
3. **团队能力**：考虑团队技术栈和学习成本
4. **性能要求**：满足业务性能 SLA

## 服务通信

### 同步通信
- **REST API**：跨服务调用
- **gRPC**：内部高性能调用

### 异步通信
- **Kafka**：事件驱动、数据同步
- **RabbitMQ**：任务队列

## 数据存储

### 数据分类
- **业务数据**：MySQL（事务性强）
- **缓存数据**：Redis（热数据）
- **日志数据**：ElasticSearch + OSS
- **文件数据**：OSS（图片、附件）

### 数据一致性
- 分布式事务：使用 Saga 模式
- 最终一致性：通过消息队列保证

详见 [数据流文档](./data-flow.md)

## 高可用设计

- **服务冗余**：每个服务至少 2 个实例
- **数据备份**：MySQL 主从 + 定时备份
- **故障转移**：自动化故障检测和切换
- **降级熔断**：保护核心链路

## 下一步

- 查看 [服务划分](./services.md) 了解各服务职责
- 查看 [数据流](./data-flow.md) 了解数据流转
- 查看 [运维文档](../../operations/overview.md) 了解部署运维
