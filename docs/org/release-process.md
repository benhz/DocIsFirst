# 发布流程

## 发布类型

### 常规发布
- 频率：每 2 周一次
- 窗口：周三 14:00-16:00
- 内容：新功能、优化、Bug 修复

### 紧急发布
- 频率：按需
- 窗口：不限（需审批）
- 内容：严重 Bug、安全漏洞

## 发布流程

### 1. 提交发布申请（T-2天）
填写发布申请单：
- 发布内容
- 影响范围
- 回滚方案
- 风险评估

### 2. 技术评审（T-1天）
- TL 评审技术方案
- 确认测试通过
- 确认数据库变更

### 3. 发布审批（T-1天）
- PM 审批需求
- TL 审批技术
- 运维审批发布

### 4. 发布准备（T-0.5天）
- 准备发布脚本
- 准备回滚方案
- 通知相关方

### 5. 执行发布（T天）
```bash
# 1. 创建 release 分支
git checkout -b release/v1.2.0 develop

# 2. 合并到 master
git checkout master
git merge release/v1.2.0

# 3. 打标签
git tag v1.2.0

# 4. 部署
kubectl apply -f k8s/
```

### 6. 验证（T天）
- 功能验证
- 监控观察
- 用户反馈

### 7. 发布通知（T天）
在企业微信群通知：
- 发布内容
- 上线时间
- 注意事项

## 发布检查清单

**发布前**：
- [ ] 代码已合并到 master
- [ ] 测试已通过
- [ ] 数据库迁移已准备
- [ ] 监控告警已配置
- [ ] 回滚方案已准备

**发布后**：
- [ ] 功能验证通过
- [ ] 监控指标正常
- [ ] 无异常告警

## 回滚流程

```bash
# 快速回滚
kubectl rollout undo deployment/app-name

# 数据库回滚（谨慎！）
# 需要 DBA 参与
```

## 发布禁忌

❌ 周五下班前发布  
❌ 节假日前发布  
❌ 深夜发布（除非紧急）  
❌ 未经测试直接发布  
